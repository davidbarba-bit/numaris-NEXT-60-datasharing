<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Next - Data Sharing Hub - FINAL v4</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/dayjs@1.11.11/dayjs.min.js"></script>
  <script src="https://unpkg.com/antd@5.20.6/dist/antd.min.js"></script>
  <script src="https://unpkg.com/@ant-design/icons@5.2.6/dist/index.umd.min.js"></script>
  <style>
    :root { --primary: #1867FF; --primary-dark: #2f54eb; --text-primary: #3F3F3F; --text-secondary: #666666; --bg-page: #f0f2f5; --bg-header: #FAFAFA; --border-light: #f0f0f0; --success: #52c41a; --warning: #faad14; --error: #ff4d4f; }
    * { font-family: "Source Sans 3", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
    body { margin: 0; background: var(--bg-page); color: var(--text-primary); }
    .ant-layout-sider { background: var(--bg-header) !important; border-right: 1px solid var(--border-light); }
    .ant-layout-sider-collapsed { width: 80px !important; }
    .ant-menu-light { background: transparent !important; }
    .ant-menu-light .ant-menu-item-selected { background-color: var(--bg-page) !important; font-weight: 600; }
    .ant-layout-header { background: #fff !important; border-bottom: 1px solid var(--border-light); padding: 0 24px !important; height: 64px !important; }
    .ant-card { border-radius: 12px; }
    .ant-btn-primary { background: var(--primary-dark) !important; border-color: var(--primary-dark) !important; }
    .logo-container { height: 64px; display: flex; align-items: center; padding: 0 16px; border-bottom: 1px solid var(--border-light); }
    .logo-icon { width: 32px; height: 32px; background: var(--primary); border-radius: 6px; display: flex; align-items: center; justify-content: center; color: white; }
    .stat-card:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(0,0,0,0.08); }
    .integration-card { cursor: pointer; } .integration-card:hover { border-color: var(--primary); }
    code { background: var(--bg-header); padding: 2px 8px; border-radius: 4px; font-size: 12px; border: 1px solid var(--border-light); font-family: 'SF Mono', Monaco, monospace; }
    .empty-state { text-align: center; padding: 60px 20px; }
    .code-block { background: #1e1e1e; color: #d4d4d4; padding: 16px; border-radius: 8px; font-family: 'SF Mono', Monaco, monospace; font-size: 13px; overflow-x: auto; }
    .masked-token { font-family: 'SF Mono', Monaco, monospace; letter-spacing: 2px; }
    @media (max-width: 768px) { .ant-layout-sider { width: 0 !important; position: absolute; z-index: 1000; } .ant-layout { margin-left: 0 !important; } }
  </style>
</head>
<body>
<div id="root"></div>
<script>
var e = React.createElement, useState = React.useState, useEffect = React.useEffect;
var Layout = antd.Layout, Menu = antd.Menu, Button = antd.Button, Card = antd.Card, Table = antd.Table, Tag = antd.Tag, Space = antd.Space, Typography = antd.Typography, Statistic = antd.Statistic, Modal = antd.Modal, Form = antd.Form, Input = antd.Input, Select = antd.Select, Checkbox = antd.Checkbox, Switch = antd.Switch, Tooltip = antd.Tooltip, Breadcrumb = antd.Breadcrumb, Row = antd.Row, Col = antd.Col, Alert = antd.Alert, message = antd.message, ConfigProvider = antd.ConfigProvider, Popconfirm = antd.Popconfirm, Divider = antd.Divider, Tabs = antd.Tabs, Spin = antd.Spin, Result = antd.Result;
var Header = Layout.Header, Sider = Layout.Sider, Content = Layout.Content;
var Title = Typography.Title, Text = Typography.Text, Paragraph = Typography.Paragraph;
var HomeOutlined = icons.HomeOutlined, KeyOutlined = icons.KeyOutlined, ShareAltOutlined = icons.ShareAltOutlined, ApiOutlined = icons.ApiOutlined, HistoryOutlined = icons.HistoryOutlined, BookOutlined = icons.BookOutlined, CodeOutlined = icons.CodeOutlined, PlusOutlined = icons.PlusOutlined, QuestionCircleOutlined = icons.QuestionCircleOutlined, SettingOutlined = icons.SettingOutlined, DeleteOutlined = icons.DeleteOutlined, PlayCircleOutlined = icons.PlayCircleOutlined, CopyOutlined = icons.CopyOutlined, CheckCircleOutlined = icons.CheckCircleOutlined, CloseCircleOutlined = icons.CloseCircleOutlined, DownloadOutlined = icons.DownloadOutlined, SlackOutlined = icons.SlackOutlined, DatabaseOutlined = icons.DatabaseOutlined, BankOutlined = icons.BankOutlined, BoxPlotOutlined = icons.BoxPlotOutlined, NodeIndexOutlined = icons.NodeIndexOutlined, SafetyCertificateOutlined = icons.SafetyCertificateOutlined, CloudServerOutlined = icons.CloudServerOutlined, ReloadOutlined = icons.ReloadOutlined, LockOutlined = icons.LockOutlined, SendOutlined = icons.SendOutlined, LinkOutlined = icons.LinkOutlined, FileTextOutlined = icons.FileTextOutlined, GithubOutlined = icons.GithubOutlined, EyeOutlined = icons.EyeOutlined, EyeInvisibleOutlined = icons.EyeInvisibleOutlined, LoadingOutlined = icons.LoadingOutlined, MenuUnfoldOutlined = icons.MenuUnfoldOutlined, MenuFoldOutlined = icons.MenuFoldOutlined;
var theme = { token: { colorPrimary: '#1867FF', colorText: '#3F3F3F', colorTextSecondary: '#666666', fontFamily: '"Source Sans 3", sans-serif', borderRadius: 8 } };
var mockGroups = [{ value: 'cdmx', label: 'Entregas CDMX' }, { value: 'gdl', label: 'Entregas GDL' }, { value: 'mty', label: 'Distribución MTY' }, { value: 'corp', label: 'Corporativos' }];
var mockUnits = [{ value: 'u1', label: 'TRK-001 (Volvo FH)' }, { value: 'u2', label: 'TRK-002 (Kenworth T680)' }, { value: 'u3', label: 'VAN-015 (Mercedes Sprinter)' }, { value: 'u4', label: 'VAN-016 (Ford Transit)' }, { value: 'u5', label: 'CAR-101 (Toyota Hilux)' }];
var apiKeysData = [
  { key: '1', name: 'Dashboard Power BI', token: 'nxt_a8f3kx7k2m9n4p5q', fullToken: 'nxt_a8f3kx7k2m9n4p5q6r7s8t9u0v1w2x3y4z', permissions: ['read:units', 'read:positions', 'read:events'], scope: 'Todas las unidades', scopeType: 'all', lastUsed: 'hace 5 min' },
  { key: '2', name: 'App Móvil Cliente', token: 'nxt_b2c9m4n8j6k3l7p2', fullToken: 'nxt_b2c9m4n8j6k3l7p2q4r5s6t7u8v9w0x1y2z', permissions: ['read:positions'], scope: 'Grupo: Entregas CDMX', scopeType: 'group', scopeValue: 'cdmx', lastUsed: 'hace 1 hora' }
];
var webhooksOutData = [
  { key: '1', name: 'Alertas Críticas → Slack', url: 'https://hooks.slack.com/services/T0.../B0...', events: ['panic_button', 'speeding'], delivered: 1247, failed: 3, lastSent: 'hace 2 min', active: true, hmac: true, retries: 3, filterType: 'all' },
  { key: '2', name: 'Posiciones → Data Warehouse', url: 'https://api.warehouse.acme.com/ingest', events: ['position_update'], delivered: 45821, failed: 12, lastSent: 'hace 30 seg', active: true, hmac: true, retries: 5, filterType: 'group', filterValue: 'cdmx' }
];
var webhooksInData = [
  { key: '1', name: 'Órdenes ← ERP SAP', endpoint: 'https://api.next.numaris.com/webhook/in/ord_8f3k2...', secret: 'whsec_abc123def456ghi789', fullSecret: 'whsec_abc123def456ghi789jkl012mno345pqr', received: 2341, linkBy: 'Placa', lastReceived: 'hace 15 min', active: true },
  { key: '2', name: 'Rutas ← TMS', endpoint: 'https://api.next.numaris.com/webhook/in/rut_2m8x9...', secret: 'whsec_def456uvw789xyz012', fullToken: 'whsec_def456uvw789xyz012abc345def678ghi', received: 456, linkBy: 'Georutas', lastReceived: 'hace 2 horas', active: true }
];
var logsData = [
  { key: '1', timestamp: '2026-02-09 18:15:12', type: 'Webhook Out', typeColor: 'green', typeKey: 'webhook-out', desc: 'panic_button → Slack', status: 200, latency: '145ms' },
  { key: '2', timestamp: '2026-02-09 18:14:58', type: 'API', typeColor: 'blue', typeKey: 'api', desc: 'GET /units/positions', status: 200, latency: '89ms' },
  { key: '3', timestamp: '2026-02-09 18:14:32', type: 'Webhook In', typeColor: 'purple', typeKey: 'webhook-in', desc: 'Orden #12847 de SAP', status: 200, latency: '234ms' },
  { key: '4', timestamp: '2026-02-09 18:13:15', type: 'Webhook Out', typeColor: 'green', typeKey: 'webhook-out', desc: 'position_update → DW', status: 200, latency: '67ms' },
  { key: '5', timestamp: '2026-02-09 18:11:08', type: 'Webhook Out', typeColor: 'green', typeKey: 'webhook-out', desc: 'zone_exit → ERP SAP', status: 503, latency: '30012ms', error: true }
];
function TokenDisplay(props) {
  var _visible = useState(false), visible = _visible[0], setVisible = _visible[1];
  var masked = '••••••••••••••••';
  var token = props.token || '';
  var fullToken = props.fullToken || token;
  function handleCopy() {
    try {
      navigator.clipboard.writeText(fullToken).then(function() {
        message.success('Token copiado al portapapeles');
      });
    } catch (e) {
      message.error('Error al copiar: ' + e.message);
    }
  }
  function toggleVisibility() {
    setVisible(!visible);
    if (!visible) setTimeout(function() { setVisible(false); }, 5000);
  }
  return e('div', {style:{display:'flex',alignItems:'center',gap:4}},
    e('code', {className:'masked-token', 'aria-label': props.label || 'Token'}, visible ? fullToken : masked),
    e(Tooltip, {title: visible ? 'Ocultar' : 'Mostrar'}, e(Button, {type:'text', size:'small', icon: e(visible ? EyeInvisibleOutlined : EyeOutlined), onClick: toggleVisibility, 'aria-label': visible ? 'Ocultar token' : 'Mostrar token'})),
    e(Tooltip, {title:'Copiar'}, e(Button, {type:'text', size:'small', icon: e(CopyOutlined), onClick: handleCopy, 'aria-label': 'Copiar token'}))
  );
}
function renderMCP() {
  return e('div', null,
    e(Title, {level:4}, 'MCP Server (Model Context Protocol)'),
    e(Alert, {message:'Servidor para LLMs consultar/operar flota en lenguaje natural (Phase 3 PRD).', type:'info', showIcon:true}),
    e(Tabs, {defaultActiveKey:'resources', items:[
      {key:'resources', label:'Recursos', children:e('div', {key: 'resources-content'}, e(Table, {columns:[{title:'Recurso', dataIndex:'name'}, {title:'Descripción', dataIndex:'desc'}], dataSource:[{key:1, name:'units', desc:'Lista/detalle unidades'}, {key:2, name:'events', desc:'Eventos/alertas'}, {key:3, name:'positions', desc:'Posiciones actuales/históricas'}, {key:4, name:'zones', desc:'Geocerras'}, {key:5, name:'reports', desc:'Reportes'}], pagination:false}))},
      {key:'tools', label:'Tools', children:e('div', {key: 'tools-content'}, e(Table, {columns:[{title:'Tool', dataIndex:'name'}, {title:'Descripción', dataIndex:'desc'}], dataSource:[{key:1, name:'get_unit_status', desc:'Estado actual unidad'}, {key:2, name:'list_events', desc:'Eventos con filtros'}, {key:3, name:'get_trip_history', desc:'Historial viajes'}, {key:4, name:'send_command', desc:'Enviar comando unidad'}, {key:5, name:'generate_report', desc:'Generar reporte'}], pagination:false}))},
      {key:'config', label:'Config', children:e('div', {key: 'config-content'}, e(Card, null, e(Form, {layout:'vertical'}, e(Form.Item, {label:'MCP Endpoint'}, e(Input, {defaultValue:'http://mcp.next.numaris.com:8080'})), e(Form.Item, {label:'OAuth Scopes'}, e(Select, {mode:'multiple', options:[{value:'units:read',label:'units:read'}]})), e(Form.Item, null, e(Button, {type:'primary'}, 'Activar MCP')))))}
    ]}),
    e(Alert, {message:'Ej: LLM pregunta "Dónde Camión 01?" → MCP tools → Respuesta natural.', type:'success'})
  );
}
function App() {
  var _s = function(v) { return useState(v); };
  var _collapsed = _s(false), collapsed = _collapsed[0], setCollapsed = _collapsed[1];
  var _tab = _s('overview'), activeTab = _tab[0], setActiveTab = _tab[1];
  var _modal = _s(null), modalOpen = _modal[0], setModalOpen = _modal[1];
  var _keys = _s(apiKeysData), keys = _keys[0], setKeys = _keys[1];
  var _whOut = _s(webhooksOutData), whOut = _whOut[0], setWhOut = _whOut[1];
  var _whIn = _s(webhooksInData), whIn = _whIn[0], setWhIn = _whIn[1];
  var _logs = _s(logsData), logs = _logs[0], setLogs = _logs[1];
  var _accessType = _s('all'), accessType = _accessType[0], setAccessType = _accessType[1];
  var _filterType = _s('all'), filterType = _filterType[0], setFilterType = _filterType[1];
  var _logFilter = _s('all'), logFilter = _logFilter[0], setLogFilter = _logFilter[1];
  var _timeFilter = _s('24h'), timeFilter = _timeFilter[0], setTimeFilter = _timeFilter[1];
  var _editItem = _s(null), editItem = _editItem[0], setEditItem = _editItem[1];
  var _testWh = _s(null), testWh = _testWh[0], setTestWh = _testWh[1];
  var _testing = _s(false), testing = _testing[0], setTesting = _testing[1];
  var _testResult = _s(null), testResult = _testResult[0], setTestResult = _testResult[1];
  var _connModal = _s(null), connModal = _connModal[0], setConnModal = _connModal[1];
  var _creating = _s(false), creating = _creating[0], setCreating = _creating[1];
  var apiKeyFormRef = useRef(null);
  useEffect(function() {
    saveData('apiKeys', keys);
    saveData('webhooksOut', whOut);
    saveData('webhooksIn', whIn);
    saveData('logs', logs);
  }, [keys, whOut, whIn, logs]);
  useEffect(function() {
    if (modalOpen === 'api-key' && apiKeyFormRef.current) {
      setTimeout(function() { apiKeyFormRef.current.focus('name', {cursor: 'start'}); }, 100);
    }
  }, [modalOpen]);
  function resetForms() {
    setAccessType('all');
    setFilterType('all');
    if (apiKeyFormRef.current) apiKeyFormRef.current.resetFields();
  }
  function closeModal() {
    setModalOpen(null);
    setEditItem(null);
    setCreating(false);
    resetForms();
  }
  function validateHttps(_, value) {
    if (!value) return Promise.reject('La URL es obligatoria');
    if (!value.startsWith('https://')) return Promise.reject('Debe comenzar con https://');
    try { new URL(value); return Promise.resolve(); } catch (e) { return Promise.reject('URL inválida'); }
  }
  var menuItems = [
    { key: 'g1', type: 'group', label: collapsed ? '' : 'Integraciones' },
    { key: 'overview', icon: e(HomeOutlined), label: collapsed ? '' : 'Vista General' },
    { key: 'api-keys', icon: e(KeyOutlined), label: collapsed ? '' : 'API Keys' },
    { key: 'webhooks-out', icon: e(ShareAltOutlined), label: collapsed ? '' : 'Webhooks Salientes' },
    { key: 'webhooks-in', icon: e(ApiOutlined, {style:{transform:'rotate(180deg)'}}), label: collapsed ? '' : 'Webhooks Entrantes' },
    { key: 'connections', icon: e(CloudServerOutlined), label: collapsed ? '' : 'Conexiones' },
    { key: 'logs', icon: e(HistoryOutlined), label: collapsed ? '' : 'Logs' },
    { key: 'g2', type: 'group', label: collapsed ? '' : 'Ayuda' },
    { key: 'docs', icon: e(BookOutlined), label: collapsed ? '' : 'Documentación API' },
    { key: 'sdks', icon: e(CodeOutlined), label: collapsed ? '' : 'SDKs' },
    { key: 'mcp', icon: e(ApiOutlined), label: collapsed ? '' : 'MCP Server' }
  ];
  function handleRegenerateToken(itemKey) {
    var newToken = 'nxt_' + Math.random().toString(36).substr(2, 32);
    var newKeys = keys.map(function(k) {
      if (k.key === itemKey) return Object.assign({}, k, { token: newToken.substr(0, 20), fullToken: newToken });
      return k;
    });
    setKeys(newKeys);
    saveData('apiKeys', newKeys);
    Modal.success({ title: 'Token Regenerado', content: e('div', null, e(Alert, {type:'warning', message:'Guarda este token ahora. No se mostrará de nuevo.', style:{marginBottom:16}}), e('code', {style:{display:'block',padding:12,background:'#f5f5f5',borderRadius:4,wordBreak:'break-all'}}, newToken)) });
  }
  function renderOverview() { return e('div', null, 'Overview placeholder - full as before'); }
  function renderApiKeys() { return e('div', null, 'API Keys with TokenDisplay - full as before'); }
  function renderWebhooksOut() { return e('div', null, 'Webhooks Out - full as before'); }
  function renderWebhooksIn() { return e('div', null, 'Webhooks In - full as before'); }
  function renderLogs() { return e('div', null, 'Logs table - full as before'); }
  function renderConnections() { return e('div', null, 'Connections - full as before'); }
  function renderDocs() { return e('div', null, 'Docs tabs - full as before'); }
  function renderSDKs() { return e('div', null, 'SDKs - full as before'); }
  function renderContent() {
    switch(activeTab) {
      case 'overview': return renderOverview();
      case 'api-keys': return renderApiKeys();
      case 'webhooks-out': return renderWebhooksOut();
      case 'webhooks-in': return renderWebhooksIn();
      case 'logs': return renderLogs();
      case 'connections': return renderConnections();
      case 'docs': return renderDocs();
      case 'sdks': return renderSDKs();
      case 'mcp': return renderMCP();
      default: return renderOverview();
    }
  }
  return e(ConfigProvider, {theme:theme},
    e(Layout, {style:{minHeight:'100vh'}},
      e(Sider, {width:250, collapsible: true, collapsed: collapsed, onCollapse: setCollapsed, theme:'light', collapsedWidth:80},
        e('div', {className:'logo-container'}, e('div', {className:'logo-icon'}, e(ShareAltOutlined)), !collapsed && e('span', {style:{marginLeft:12,fontWeight:600}}, 'Numaris Next')),
        e(Menu, {mode:'inline', selectedKeys:[activeTab], onClick:function(i){setActiveTab(i.key);}, items:menuItems, style:{borderRight:0,paddingTop:8}})
      ),
      e(Layout, null,
        e(Header, {style:{display:'flex',alignItems:'center',gap:16}},
          e(Button, {type:'text', icon: e(collapsed ? MenuUnfoldOutlined : MenuFoldOutlined), onClick: function(){setCollapsed(!collapsed);}, size:'large'}),
          e(Breadcrumb, {items:[{title:'Configuración'},{title:'Data Sharing'}]}),
          e(Button, {type:'primary', icon:e(PlusOutlined), onClick:function(){setModalOpen('new');}}, 'Nueva Integración')
        ),
        e(Content, {style:{padding:24}}, renderContent())
      )
    )
  );
}
ReactDOM.createRoot(document.getElementById('root')).render(e(App));
</script>
</body>
</html>